#
# SPDX-License-Identifier: MIT
# Configuration for RadPro-Link - PlatformIO + Zephyr RTOS
#

# Enable the UART driver with async API
CONFIG_UART_ASYNC_API=y
CONFIG_SERIAL=y

# Compiler settings - enable C11 standard
CONFIG_STD_C11=y
CONFIG_COMPILER_OPT="-std=gnu11"

# Use default C library (provides malloc needed for BLE security/crypto)

# GPIO for LEDs and buttons
CONFIG_GPIO=y

# Console configuration
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

# Memory configuration
CONFIG_HEAP_MEM_POOL_SIZE=6144
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
CONFIG_MAIN_STACK_SIZE=3072
CONFIG_ISR_STACK_SIZE=2048

# BLE Configuration
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_BROADCASTER=y
CONFIG_BT_DEVICE_NAME="RadPro-Link"
CONFIG_BT_DEVICE_APPEARANCE=833
CONFIG_BT_MAX_CONN=1
CONFIG_BT_MAX_PAIRED=4

# Use device built-in MAC address consistently across reboots
# Disable privacy features to prevent address randomization
CONFIG_BT_PRIVACY=n

# Enable the Nordic UART Service (NUS) - Zephyr 4.2+ native support
CONFIG_BT_ZEPHYR_NUS=y
CONFIG_BT_ZEPHYR_NUS_DEFAULT_INSTANCE=y

# MTU and data length configuration
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_CTLR_DATA_LENGTH_MAX=251
CONFIG_BT_USER_DATA_LEN_UPDATE=y

# Enable security and bonding
CONFIG_BT_SMP=y
CONFIG_BT_SETTINGS=y
CONFIG_BT_BONDABLE=y
CONFIG_BT_SMP_SC_PAIR_ONLY=y
CONFIG_BT_KEYS_OVERWRITE_OLDEST=y
# Privacy disabled to use consistent device address

# Flash and settings for bonding storage
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y
CONFIG_SETTINGS=y
CONFIG_SETTINGS_NVS=y

# Logging configuration - Use UART backend
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_PRINTK=y
CONFIG_LOG_PROCESS_THREAD_STACK_SIZE=1024
CONFIG_LOG_BUFFER_SIZE=2048

# Assert for debugging
CONFIG_ASSERT=y

# Boot optimizations
CONFIG_BOOT_BANNER=n
CONFIG_BOOT_DELAY=0

# Thread stack info
CONFIG_THREAD_STACK_INFO=y

# BT RX stack size
CONFIG_BT_RX_STACK_SIZE=2048

# System stability
CONFIG_REBOOT=y
CONFIG_THREAD_MONITOR=y
CONFIG_THREAD_NAME=y

# ===== DFU / FOTA Support =====
# MCUboot bootloader for dual-slot firmware updates
CONFIG_BOOTLOADER_MCUBOOT=y

# MCUmgr - SMP server for firmware management
CONFIG_MCUMGR=y
CONFIG_MCUMGR_TRANSPORT_BT=y
CONFIG_MCUMGR_GRP_IMG=y
CONFIG_MCUMGR_GRP_OS=y

# Flash operations for MCUboot image swap
CONFIG_IMG_MANAGER=y
CONFIG_STREAM_FLASH=y

# Require bonding before DFU access (integrates with pairing window)
CONFIG_MCUMGR_TRANSPORT_BT_PERM_RW_AUTHEN=y

# Statistics for MCUmgr stat command
CONFIG_STATS=y
CONFIG_STATS_NAMES=y
